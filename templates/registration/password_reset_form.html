{% extends "main/layout.html" %}
{% load static %}

{% block title %}–°–∫–∏–Ω—É—Ç–∏ –ø–∞—Ä–æ–ª—å{% endblock %}

{% block content %}
<div class="login-wrapper">
  <div class="login-card form-wrapper">
    <div class="form-header">
      <img src="{% static 'media/images/olx.svg' %}" alt="Logo" class="form-logo">
      <h3 class="form-title">–°–∫–∏–Ω—É—Ç–∏ –ø–∞—Ä–æ–ª—å</h3>
    </div>

    <form method="post" novalidate>
      {% csrf_token %}

      {% for field in form %}
      <div class="input-group">
        {{ field }}
        {% if field.errors %}
          <ul class="errorlist">
            {% for error in field.errors %}
              <li>{{ error }}</li>
            {% endfor %}
          </ul>
        {% endif %}
      </div>
      {% endfor %}

      <button type="submit">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é</button>
    </form>
  </div>
</div>

<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", () => {
  const emailInput = document.querySelector('input[type="email"]');
  if (!emailInput) return;

  // üîπ –ó–∞–±–æ—Ä–æ–Ω–µ–Ω—ñ —Å–∏–º–≤–æ–ª–∏
  const forbiddenChars = [' ', ',', ';', '"', "'", '(', ')', '[', ']', '{', '}', '\\', '|', '/', ':', '<', '>', '!', '#', '$', '%', '^', '&', '*', '='];

  // üîπ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É –≤–≤–µ–¥–µ–Ω–Ω—ñ
  emailInput.addEventListener("input", () => {
    let value = emailInput.value;

    // –í–∏–¥–∞–ª—è—î–º–æ –∑–∞–±–æ—Ä–æ–Ω–µ–Ω—ñ —Å–∏–º–≤–æ–ª–∏
    forbiddenChars.forEach(char => {
      value = value.replaceAll(char, '');
    });
    emailInput.value = value;

    // –í–∞–ª—ñ–¥–∞—Ü—ñ—è –ø—ñ–¥ —á–∞—Å –≤–≤–µ–¥–µ–Ω–Ω—è
    validateEmail(emailInput);
  });

  // üîπ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∏ –≤–∏—Ö–æ–¥—ñ –∑ –ø–æ–ª—è (–Ω–∞ –≤—Å—è–∫ –≤–∏–ø–∞–¥–æ–∫)
  emailInput.addEventListener("blur", () => validateEmail(emailInput));

  function validateEmail(input) {
    const email = input.value.trim();
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    if (!email) {
      removeError(input);
      input.classList.remove("is-invalid", "is-valid");
      return;
    }

    if (!emailPattern.test(email)) {
      input.classList.add("is-invalid");
      input.classList.remove("is-valid");
      showError(input, "–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç email");
    } else {
      input.classList.add("is-valid");
      input.classList.remove("is-invalid");
      removeError(input);
    }
  }

  function showError(input, message) {
    removeError(input);
    const error = document.createElement("div");
    error.className = "errorlist";
    error.textContent = message;
    input.insertAdjacentElement("afterend", error);
  }

  function removeError(input) {
    const next = input.nextElementSibling;
    if (next && next.classList.contains("errorlist")) next.remove();
  }
});
</script>
{% endblock %}
