{% extends 'main/layout.html' %}
{% load static %}

{% block title %}–ì–æ–ª–æ–≤–Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫–∞{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-10 offset-md-1">

            <!-- ‚úÖ –ó–º—ñ–Ω–∏–≤ action, —â–æ–± –≤—ñ–¥–ø—Ä–∞–≤–ª—è–ª–æ –Ω–∞ search_ads -->
            <form action="{% url 'search_ads' %}" method="GET" class="search-bar d-flex shadow-sm" novalidate>
              <div class="search-field flex-grow-1 position-relative"> <!-- position-relative here -->
                <i class="fa fa-search search-icon"></i>
                <input
                    type="text"
                    id="search-input"
                    class="search-input form-control"
                    name="q"
                    placeholder="–©–æ —à—É–∫–∞—î—Ç–µ?"
                    value="{{ request.GET.q }}"
                    autocomplete="off"
                    aria-autocomplete="list"
                    aria-controls="suggestions"
                    aria-expanded="false"
                    role="combobox"
                    aria-haspopup="listbox"
                    aria-activedescendant=""
                >
                <!-- Suggestions dropdown -->
                <div id="suggestions"
                     class="suggestions dropdown-menu w-100"
                     role="listbox"
                     aria-label="–ü—ñ–¥–∫–∞–∑–∫–∏ –ø–æ—à—É–∫—É"
                     style="display:none; z-index:1000;">
                </div>
              </div>

              <!-- üìç –ü–æ–ª–µ –ª–æ–∫–∞—Ü—ñ—ó -->
              <div class="search-field flex-grow-1">
                <i class="fa fa-location-dot search-icon"></i>
                <input
                  type="text"
                  id="place-input"
                  class="form-control"
                  name="place"
                  placeholder="–£—Å—è –£–∫—Ä–∞—ó–Ω–∞"
                  value="{{ request.GET.place }}"
                  autocomplete="off"
                >
                <div id="place-suggestions" class="suggestions"></div>
              </div>

              <button type="submit" class="btn btn-dark search-button">
                <strong>–ü–æ—à—É–∫</strong> <i class="fa fa-search"></i>
              </button>
            </form>

        </div>
    </div>
</div>

<div class="container mt-5 text-center">
    <h2>–†–æ–∑–¥—ñ–ª–∏ –Ω–∞ —Å–µ—Ä–≤—ñ—Å—ñ</h2>
    </div>

<footer class="page-footer mt-5">
    <div class="container text-center py-5">

        <img src="{% static 'media/images/olx.svg' %}" alt="OLX logo" class="footer-logo mb-4">

        <p class="footer-text mb-4">
            –£—Å—ñ –æ–Ω–ª–∞–π–Ω-–æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –£–∫—Ä–∞—ó–Ω–∏ –Ω–∞ OLX - —Ç—É—Ç –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ —Ç–µ, —â–æ —à—É–∫–∞–ª–∏! <br>
            –ù–∞—Ç–∏—Å–Ω—É–≤—à–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ü–æ–¥–∞—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è", –≤–∏ –∑–º–æ–∂–µ—Ç–µ —Ä–æ–∑–º—ñ—Å—Ç–∏—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –Ω–∞ –±—É–¥—å-—è–∫—É —Ç–µ–º–∞—Ç–∏–∫—É –ª–µ–≥–∫–æ –π —à–≤–∏–¥–∫–æ. <br>
            –ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å–µ—Ä–≤—ñ—Å—É OLX –≤–∏ –∑–º–æ–∂–µ—Ç–µ –∫—É–ø–∏—Ç–∏ —á–∏ –ø—Ä–æ–¥–∞—Ç–∏ –∑ —Ä—É–∫ —É —Ä—É–∫–∏ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ –≤—Å–µ, —â–æ –∑–∞–≤–≥–æ–¥–Ω–æ.
        </p>

        <p class="footer-social-title mb-2">–°—Ç–µ–∂—Ç–µ –∑–∞ OLX —É —Å–æ—Ü–º–µ—Ä–µ–∂–∞—Ö</p>

        <div class="footer-social-links">
            <a href="#" class="social-link" aria-label="Facebook">
                <i class="fa-brands fa-facebook-f"></i>
            </a>
            <a href="#" class="social-link" aria-label="YouTube">
                <i class="fa-brands fa-youtube"></i>
            </a>
            <a href="#" class="social-link" aria-label="Twitter">
                <i class="fa-brands fa-x-twitter"></i>
            </a>
        </div>

    </div>
</footer>

<script>
document.addEventListener("DOMContentLoaded", function () {
  // -----------------
  // –ü–æ–ª–µ "–©–æ —à—É–∫–∞—î—Ç–µ?"
  // -----------------
  const titleInput = document.querySelector('input[name="q"]');
  const titleBox = document.querySelector('#suggestions'); // ‚úÖ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –≤–∂–µ —ñ—Å–Ω—É—é—á–∏–π div

  titleInput.addEventListener("input", async function () {
    const query = this.value.trim();
    if (query.length < 2) {
      titleBox.classList.remove("active");
      titleBox.style.display = "none";
      return;
    }

    try {
      const response = await fetch(`/ajax/suggestions/?q=${encodeURIComponent(query)}`);
      if (!response.ok) return;
      const data = await response.json();

      if (data.length === 0) {
        titleBox.classList.remove("active");
        titleBox.style.display = "none";
        return;
      }

      titleBox.innerHTML = data
        .map(item => `<div class="suggestion-item">${item}</div>`)
        .join("");
      titleBox.classList.add("active");
      titleBox.style.display = "block";

      titleBox.querySelectorAll(".suggestion-item").forEach(item => {
        item.addEventListener("click", () => {
          titleInput.value = item.textContent;
          titleBox.classList.remove("active");
          titleBox.style.display = "none";
        });
      });
    } catch (e) {
      console.error("Error fetching title suggestions:", e);
    }
  });

  // -----------------
  // –ü–æ–ª–µ "–õ–æ–∫–∞—Ü—ñ—è" (–±–µ–∑ –±–∞–∑–∏)
  // -----------------
  const placeInput = document.querySelector('input[name="place"]');
  const placeBox = document.querySelector('#place-suggestions'); // ‚úÖ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –≤–∂–µ –Ω–∞—è–≤–Ω–∏–π div

  if (!placeInput || !placeBox) {
    console.error("‚ùå –ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ –ø–æ–ª–µ –∞–±–æ –±–ª–æ–∫ –¥–ª—è –ø—ñ–¥–∫–∞–∑–æ–∫ –º—ñ—Å—Ü—è!");
    return;
  }

  const cities = [
    "–ö–∏—ó–≤", "–õ—å–≤—ñ–≤", "–û–¥–µ—Å–∞", "–•–∞—Ä–∫—ñ–≤", "–î–Ω—ñ–ø—Ä–æ",
    "–í—ñ–Ω–Ω–∏—Ü—è", "–ü–æ–ª—Ç–∞–≤–∞", "–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫", "–ß–µ—Ä–Ω—ñ–≤—Ü—ñ",
    "–£–∂–≥–æ—Ä–æ–¥", "–ó–∞–ø–æ—Ä—ñ–∂–∂—è", "–ú–∏–∫–æ–ª–∞—ó–≤", "–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∏–π", "–†—ñ–≤–Ω–µ"
  ];

  placeInput.addEventListener("input", function () {
    const query = this.value.trim().toLowerCase();
    if (query.length < 2) {
      placeBox.classList.remove("active");
      placeBox.style.display = "none";
      return;
    }

    const filtered = cities.filter(city => city.toLowerCase().includes(query));
    if (filtered.length === 0) {
      placeBox.classList.remove("active");
      placeBox.style.display = "none";
      return;
    }

    placeBox.innerHTML = filtered
      .map(item => `<div class="suggestion-item">${item}</div>`)
      .join("");
    placeBox.classList.add("active");
    placeBox.style.display = "block";

    placeBox.querySelectorAll(".suggestion-item").forEach(item => {
      item.addEventListener("click", () => {
        placeInput.value = item.textContent;
        placeBox.classList.remove("active");
        placeBox.style.display = "none";
      });
    });
  });
});
</script>



{% endblock %}