{% extends 'main/layout.html' %}
{% load static %}
{% block content %}

<div class="edit-profile-card">
    <h2><i class="fa-solid fa-user" style="color: #3a1a30"></i> Профіль користувача</h2>

    <div class="profile-view">
        <!-- Фото профілю -->
        <div class="avatar-section">
            <img src="{{ user.profile.image_url }}"
                 class="profile-avatar-preview"
                 alt="Avatar"
                 onclick="openImageModal(this.src)">
        </div>
        <!-- Інформація -->
        <div class="form-group">
            <label>Ім’я користувача</label>
            <p>{{ profile_data.full_name|default:user.username }}</p>
        </div>

        <div class="form-group">
            <label>Опис</label>
            <p>{{ user.profile.bio|default:'Не вказано' }}</p>
        </div>

        <div class="form-group">
            <label>Телефон</label>
            <p>{{ user.profile.phone|default:'Не вказано' }}</p>
        </div>

        <div class="form-group">
            <label>Місцезнаходження</label>
            <p>{{ user.profile.location|default:'Не вказано' }}</p>
        </div>

        <!-- Кнопки -->
        <div class="profile-buttons">
            <a href="{% url 'edit_profile' %}" class="btn btn-pink me-2">
                <i class="fa-solid fa-pen-to-square"></i> Редагувати
            </a>
            <a href="javascript:history.back()" class="btn btn-gradient">
                <i class="fa-solid fa-arrow-left"></i> Назад
            </a>
        </div>
    </div>
</div>
<script>
let cropper;
let croppedBlob = null;

const avatarInput = document.getElementById('avatarInput');
const cropperModal = document.getElementById('cropperModal');
const croppedImage = document.getElementById('croppedImage');
const cropButton = document.getElementById('cropButton');

// === 1. Відкрити Cropper при виборі нового фото ===
if (avatarInput && cropperModal && croppedImage) {
    avatarInput.addEventListener('change', function (e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (event) {
                croppedImage.src = event.target.result;
                cropperModal.style.display = 'flex';
                if (cropper) cropper.destroy();
                cropper = new Cropper(croppedImage, {
                    aspectRatio: 1,
                    viewMode: 1,
                    responsive: true,
                });
            };
            reader.readAsDataURL(file);
        }
    });
}

// === 2. Обрізати і зберегти зображення ===
if (cropButton && cropperModal) {
    cropButton.addEventListener('click', function () {
        if (cropper) {
            cropper.getCroppedCanvas().toBlob(function (blob) {
                croppedBlob = blob;
                cropperModal.style.display = 'none';
            });
        }
    });
}

</script>
{% endblock %}
